---
title: "Untitled"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# https://github.com/juftin/camply

library(reticulate)
library(tidyverse)
# use_python("/Users/brendangraham/Library/r-miniconda/envs/r-reticulate/bin/python3")
# py_install("camply", python_version = 3, pip = TRUE)
# py_install("pandas", python_version = 3, pip = TRUE)
# py_install("NumPy", python_version = 3, pip = TRUE)
# py_install("python-dotenv", python_version = 3, pip = TRUE)
# py_install("tenacity", python_version = 3, pip = TRUE)
# py_install("PyYAML", python_version = 3, pip = TRUE)

# virtualenv_create(envname = "r-reticulate",
#                   python = "/Users/brendangraham/Library/r-miniconda/envs/r-reticulate/bin/python3",
#                   packages = FALSE
#                   )

use_virtualenv("r-reticulate")
# conda_install("r-reticulate", "camply")
# conda_install("r-reticulate", "pandas = 1.3.0")



```

```{python}

import datetime
import logging
from typing import List
import pandas as pd

from camply.containers import AvailableCampsite, SearchWindow
from camply.search import SearchRecreationDotGov

logging.basicConfig(format="%(asctime)s [%(levelname)8s]: %(message)s",
                    level=logging.INFO)

month_of_june = SearchWindow(start_date=datetime(year = 2022, month = 6, day = 1),
                             end_date=datetime(year = 2022, month = 6, day = 30))
                             
camping_finder = SearchRecreationDotGov(search_window = month_of_june,
                                        recreation_area = 187,  # raystown lake
                                        campgrounds = 233626, # seven points
                                        weekends_only = False,
                                        nights = 5)
                                        
match: List[AvailableCampsite] = camping_finder.get_matching_campsites(log=False, verbose=True, continuous=False)

match: List[results]

results_df = pd.DataFrame(results)


AvailableCampsite(campsite_id="5391",
                  booking_date=datetime.datetime(2022, 6, 13, 0, 0),
                  booking_nights = 4,
                  booking_end_date = datetime.datetime(2022, 6, 17, 0, 0),
                  campsite_site_name="B37",
                  campsite_loop_name="Loop B",
                  campsite_type="STANDARD NONELECTRIC",
                  campsite_occupancy=(0, 8),
                  campsite_use_type="Overnight",
                  availability_status="Available",
                  recreation_area="Glacier National Park, MT",
                  recreation_area_id="2725",
                  facility_name="Fish Creek Campground",
                  facility_id="232493",
                  booking_url="https://www.recreation.gov/camping/campsites/5391"
                  )
                      

```

```{r}
py$results_df %>%
  filter(campsite_loop_name == "SENO") %>% View

```